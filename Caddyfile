:80 {
	log

	handle /health {
		respond "OK" 200
	}

	handle {
		# Match /user/repo pattern → instll/install.sh
		@install_script path_regexp user_repo ^/([^/]+)/([^/]+)/?$
		header @install_script Cache-Control "no-cache, no-store, must-revalidate"
		header @install_script Pragma "no-cache"
		header @install_script Expires "0"
		redir @install_script https://raw.githubusercontent.com/{re.user_repo.1}/{re.user_repo.2}/refs/heads/main/instll/install.sh?t={time.unix} 302

		# Match /user/repo/script pattern → instll/script.sh (auto-add .sh extension)
		@custom_script path_regexp user_repo_script ^/([^/]+)/([^/]+)/(.+)$
		header @custom_script Cache-Control "no-cache, no-store, must-revalidate"
		header @custom_script Pragma "no-cache"
		header @custom_script Expires "0"
		redir @custom_script https://raw.githubusercontent.com/{re.user_repo_script.1}/{re.user_repo_script.2}/refs/heads/main/instll/{re.user_repo_script.3}.sh?t={time.unix} 302

		# Default redirect to GitHub repo
		redir https://github.com/rbbr-io/instll.sh 302
	}
}